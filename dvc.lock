schema: '2.0'
stages:
  get_ncbi_refseq:
    cmd: bash pipeline/s0.0_get_ncbi_refseq.sh
    deps:
    - path: pipeline/s0.0_get_ncbi_refseq.sh
      md5: 837b5f5eafaeb1bce06b909476276d05
      size: 8151
    outs:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
  get_bacdive_ogt:
    cmd: python pipeline/s0.1_get_bacdive_ogt.py
    deps:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
    - path: ./learn2therm/bacdive.py
      md5: ef9b89b5b556c61b7ab306a1e13be513
      size: 1383
    - path: ./learn2therm/io.py
      md5: 3be212c4a87b76fc4f9ef298524bf33d
      size: 3818
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: pipeline/s0.1_get_bacdive_ogt.py
      md5: 237229bac42ebc65043e5a3145d9f483
      size: 8511
    params:
      params.yaml:
        get_bacdive_ogt.n_jobs: 6
        get_bacdive_ogt.n_sample:
    outs:
    - path: ./data/metrics/s0.1_metrics.yaml
      md5: b057c231026ca4b0fa9d2fc8e3307d46
      size: 78
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
  get_proteins:
    cmd: python pipeline/s1.1_get_protein_sequences.py
    deps:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
    - path: ./learn2therm/io.py
      md5: 3be212c4a87b76fc4f9ef298524bf33d
      size: 3818
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: pipeline/s1.1_get_protein_sequences.py
      md5: 5f3f687021666da337b95ae938bb1363
      size: 5865
    params:
      params.yaml:
        get_protein_sequences.n_jobs: 6
        get_protein_sequences.n_sample:
    outs:
    - path: ./data/metrics/s1.1_metrics.yaml
      md5: 8c34f4fefe92eac1fc9656ba83be235a
      size: 55
    - path: ./data/plots/protein_length_hist.png
      md5: 80b0e3c3f4a942c80d6dad7e0b11fe52
      size: 56916
    - path: ./data/taxa/16s_rRNA.csv
      md5: 3942689af979c3fdafe875db11089c7f
      size: 21316764
    - path: ./data/taxa/proteins
      md5: 905941f50af6d9eb35e960dcb3bcee85.dir
      size: 24260212365
      nfiles: 16664
  label_taxa:
    cmd: python pipeline/s1.0_label_taxa.py
    deps:
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: pipeline/s1.0_label_taxa.py
      md5: c0fcb9fe2835e2a8d851c25d4a63ed80
      size: 3668
    params:
      params.yaml:
        label_taxa.ogt_determination_method: true ogt only
        label_taxa.ogt_threshold: 40.0
    outs:
    - path: ./data/metrics/s1.0_metrics.yaml
      md5: b81c7de57507e95b010902f79b970d99
      size: 26
    - path: ./data/plots/ogt_hist.png
      md5: 871e6c2307c407eda0191b082617a367
      size: 35538
    - path: ./data/taxa/labels.csv
      md5: 22b516c22355a1697527f0099c5b8075
      size: 161752
  get_16s_blast_scores:
    cmd: python pipeline/s1.2_get_16s_blast_scores.py
    deps:
    - path: ./data/taxa/16s_rRNA.csv
      md5: 3942689af979c3fdafe875db11089c7f
      size: 21316764
    - path: ./data/taxa/labels.csv
      md5: 22b516c22355a1697527f0099c5b8075
      size: 161752
    - path: ./learn2therm/blast.py
      md5: 414afa5abb1506c63ace90ff598ccd0a
      size: 29838
    - path: ./learn2therm/io.py
      md5: 3be212c4a87b76fc4f9ef298524bf33d
      size: 3818
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: ./pipeline/s1.2_get_16s_blast_scores.py
      md5: 575ae8c515152971db113b8a5d96d91c
      size: 5727
    params:
      params.yaml:
        get_16s_blast_scores.blast_metrics:
        - local_E_value
        - scaled_local_query_percent_id
        - scaled_local_symmetric_percent_id
        - local_gap_compressed_percent_id
        - local_average_coverage
        get_16s_blast_scores.gapextend_penalty: 1
        get_16s_blast_scores.gapopen_penalty: 2
        get_16s_blast_scores.n_sample:
        get_16s_blast_scores.num_threads: 6
        get_16s_blast_scores.penalty: -2
        get_16s_blast_scores.reward: 1
        get_16s_blast_scores.ungapped: false
        get_16s_blast_scores.word_size: 28
    outs:
    - path: ./data/metrics/s1.2_metrics.yaml
      md5: d8037d675c3ac5efbe7fd85ca5316cfd
      size: 51
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: 425198fcaf0709a9a4959f84e5194d6d
      size: 69641584
  label_all_pairs:
    cmd: python pipeline/s1.3_label_all_pairs.py
    deps:
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: 425198fcaf0709a9a4959f84e5194d6d
      size: 69641584
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: ./pipeline/s1.3_label_all_pairs.py
      md5: f0d91704f22ee5db710eee93b4a16607
      size: 3385
    params:
      params.yaml:
        label_all_pairs.blast_metric_thresholds:
          scaled_local_symmetric_percent_id:
            thresh: 0.88
            greater: true
          local_average_coverage:
            thresh: 0.75
            greater: true
    outs:
    - path: ./data/metrics/s1.3_metrics.yaml
      md5: 17ebe184c757a0eaebe16f820785d8e5
      size: 67
    - path: ./data/taxa_pairs/pair_labels.csv
      md5: e315bd05d1f5aa47e198e42e49046f42
      size: 9633344
  get_protein_blast_scores:
    cmd: python pipeline/s1.4_get_protein_blast_scores.py
    deps:
    - path: ./data/taxa/proteins
      md5: 905941f50af6d9eb35e960dcb3bcee85.dir
      size: 24260212365
      nfiles: 16664
    - path: ./data/taxa_pairs/pair_labels.csv
      md5: f2136cb3b6d8d5b17afb41d6d8e857b6
      size: 9633344
    - path: ./pipeline/s1.4_get_protein_blast_scores.py
      md5: 19ccb606a753c82fc5015ce996457d16
      size: 8740
    params:
      params.yaml:
        get_protein_blast_scores.blast_metrics:
        - local_E_value
        - scaled_local_query_percent_id
        - scaled_local_symmetric_percent_id
        - local_gap_compressed_percent_id
        get_protein_blast_scores.dask_cluster_class: SLURMCluster
        get_protein_blast_scores.max_protein_length: 150
        get_protein_blast_scores.method: blast
        get_protein_blast_scores.method_blast_params:
          num_threads: 6
          word_size: 3
          gapopen: 11
          gapextend: 1
          matrix: BLOSUM62
          threshold: 11
          ungapped: false
        get_protein_blast_scores.method_diamond_params:
          num_threads: 5
          sensitivity: sensitive
          iterate: true
          global_ranking:
          gapopen: 11
          gapextend: 1
          matrix: BLOSUM62
        get_protein_blast_scores.restart: false
    outs:
    - path: ./data/metrics/s1.4_metrics.yaml
      md5: a66d0a9879612747d29b9f87e6744e52
      size: 135
    - path: ./data/taxa_pairs/pairwise_protein_blast.csv
      md5: 8e4fdcc6d42d28c8247d5d0832c9bcde
      size: 1723471054
