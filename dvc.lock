schema: '2.0'
stages:
  get_ncbi_refseq:
    cmd: bash pipeline/s0.0_get_ncbi_refseq.sh
    deps:
    - path: pipeline/s0.0_get_ncbi_refseq.sh
      md5: 837b5f5eafaeb1bce06b909476276d05
      size: 8151
    outs:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664

  get_bacdive_ogt:
    cmd: python pipeline/s0.1_get_bacdive_ogt.py
    deps:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
    - path: pipeline/s0.1_get_bacdive_ogt.py
      md5: 2be959a8c38618f0cc0099f7171f190e
      size: 8538
    params:
      pipeline/s0_data_extraction_params.yaml:
        get_bacdive_ogt.n_jobs: 6
        get_bacdive_ogt.n_sample:
    outs:
    - path: ./data/metrics/s0.1_metrics.yaml
      md5: b057c231026ca4b0fa9d2fc8e3307d46
      size: 78
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
  get_proteins:
    cmd: python pipeline/s1.1_get_protein_sequences.py
    deps:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
    - path: pipeline/s1.1_get_protein_sequences.py
      md5: f4efa5463eba6cbe477af256e8de00dd
      size: 4888
    params:
      pipeline/s1_data_processing_params.yaml:
        get_protein_sequences.n_jobs: 2
        get_protein_sequences.n_sample:
    outs:
    - path: ./data/metrics/s1.1_metrics.yaml
      md5: 8c34f4fefe92eac1fc9656ba83be235a
      size: 55
    - path: ./data/taxa/16s_rRNA.csv
      md5: 60d4e15a596f3b8175f744994b6bf60e
      size: 21316764
    - path: ./data/taxa/proteins.csv
      md5: cc0494917cc1f7e7c8c40604363c6884
      size: 23950681337
  label_taxa:
    cmd: python pipeline/s1.0_label_taxa.py
    deps:
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
    - path: pipeline/s1.0_label_taxa.py
      md5: 885283271394a0d5f91db4f039113b2e
      size: 3696
    params:
      pipeline/s1_data_processing_params.yaml:
        label_taxa.ogt_determination_method: true ogt only
        label_taxa.ogt_threshold: 40.0
    outs:
    - path: ./data/metrics/s1.0_metrics.yaml
      md5: b81c7de57507e95b010902f79b970d99
      size: 26
    - path: ./data/plots/ogt_hist.png
      md5: 871e6c2307c407eda0191b082617a367
      size: 35538
    - path: ./data/taxa/labels.csv
      md5: 22b516c22355a1697527f0099c5b8075
      size: 161752
  get_16s_blast_scores:
    cmd: python pipeline/s1.2_get_16s_blast_scores.py
    deps:
    - path: ./data/taxa/16s_rRNA.csv
      md5: fd367e500fc781453b73a4617ce4075a
      size: 21316764
    - path: ./data/taxa/labels.csv
      md5: 69ee2d0057dc0c1c1fcfabcc98b3327c
      size: 160870
    - path: ./pipeline/s1.2_get_16s_blast_scores.py
      md5: 9bfe80f82977865055995be54dd98bdb
      size: 5534
    params:
      pipeline/s1_data_processing_params.yaml:
        get_16s_blast_scores.blast_metrics:
        - local_E_value
        - scaled_local_query_percent_id
        - scaled_local_symmetric_percent_id
        - local_gap_compressed_percent_id
        get_16s_blast_scores.gapextend_penalty: 2
        get_16s_blast_scores.gapopen_penalty: 5
        get_16s_blast_scores.n_jobs: 2
        get_16s_blast_scores.n_sample:
        get_16s_blast_scores.penalty: -3
        get_16s_blast_scores.reward: 2
        get_16s_blast_scores.ungapped: false
        get_16s_blast_scores.word_size: 28
    outs:
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: cd9d392d657f8311dcc5a32ffa6e1291
      size: 189493357
  label_all_pairs:
    cmd: python pipeline/s1.3_label_all_pairs.py
    deps:
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: cd9d392d657f8311dcc5a32ffa6e1291
      size: 189493357
    - path: ./pipeline/s1.3_label_all_pairs.py
      md5: f9c6c3f0b293809c3caf137e0fe17c0e
      size: 3299
    params:
      pipeline/s1_data_processing_params.yaml:
        label_all_pairs:
          blast_metric_thresholds:
            scaled_local_symmetric_percent_id:
              thresh: 0.88
              greater: true
            local_E_value:
              thresh: 1e-50
              greater: false
    outs:
    - path: ./data/metrics/s1.3_metrics.yaml
      md5: 13ed9fb21f1a14ac92131de35d7a2b06
      size: 31
    - path: ./data/taxa_pairs/pair_labels.csv
      md5: f13bf791a3da8511ee6debc36f27cab2
      size: 35285702
