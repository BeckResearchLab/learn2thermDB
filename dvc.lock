schema: '2.0'
stages:
  get_ncbi_refseq:
    cmd: bash pipeline/s0.0_get_ncbi_refseq.sh
    deps:
    - path: pipeline/s0.0_get_ncbi_refseq.sh
      md5: 837b5f5eafaeb1bce06b909476276d05
      size: 8151
    outs:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
  get_bacdive_ogt:
    cmd: python pipeline/s0.1_get_bacdive_ogt.py
    deps:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
    - path: ./learn2therm/bacdive.py
      md5: 301d7cf43ccc7efc2eb4d418169578c7
      size: 1454
    - path: ./learn2therm/io.py
      md5: 0486f89d5dc673fab5af776b57cfd8d2
      size: 3945
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: pipeline/s0.1_get_bacdive_ogt.py
      md5: 237229bac42ebc65043e5a3145d9f483
      size: 8511
    params:
      params.yaml:
        get_bacdive_ogt.n_jobs: 6
        get_bacdive_ogt.n_sample:
    outs:
    - path: ./data/metrics/s0.1_metrics.yaml
      md5: b057c231026ca4b0fa9d2fc8e3307d46
      size: 78
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
  get_proteins:
    cmd: python pipeline/s1.1_get_protein_sequences.py
    deps:
    - path: ./data/refseq
      md5: 7e3fa86ff45297a95e4e235097ca92c7.dir
      size: 52933152676
      nfiles: 16664
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
    - path: ./learn2therm/io.py
      md5: 0486f89d5dc673fab5af776b57cfd8d2
      size: 3945
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: pipeline/s1.1_get_protein_sequences.py
      md5: ef8625578028b4eb93e7ef473e236a55
      size: 6098
    params:
      params.yaml:
        get_protein_sequences.n_jobs: 40
        get_protein_sequences.n_sample:
    outs:
    - path: ./data/metrics/s1.1_metrics.yaml
      md5: 8c34f4fefe92eac1fc9656ba83be235a
      size: 55
    - path: ./data/plots/protein_length_hist.png
      md5: 80b0e3c3f4a942c80d6dad7e0b11fe52
      size: 56916
    - path: ./data/taxa/16s_rRNA.csv
      md5: 1b0a6d0685ebb0e678b72cb3b57ae8a4
      size: 21316764
    - path: ./data/taxa/proteins
      md5: d1c8cfa94113ff9ac352fd400f543432.dir
      size: 24260213045
      nfiles: 16665
  label_taxa:
    cmd: python pipeline/s1.0_label_taxa.py
    deps:
    - path: ./data/taxa.parquet
      md5: e62b6a3fbb8232e4dfeca04c863ba761
      size: 6487331
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: pipeline/s1.0_label_taxa.py
      md5: 25490ac9fbdb57c0499c5ea44346157d
      size: 2151
    params:
      params.yaml:
        label_taxa.ogt_threshold: 40.0
    outs:
    - path: ./data/metrics/s1.0_metrics.yaml
      md5: dc8b932adf1ca2bb9256408a6ae075a1
      size: 26
    - path: ./data/plots/ogt_hist.png
      md5: 466d2be9c799b458bd6ad9897d9904ad
      size: 34384
    - path: ./data/taxa_thermophile_labels.parquet
      md5: 50bc6d01dae38aefde571ba766851e4f
      size: 120740
  get_16s_blast_scores:
    cmd: python pipeline/s1.2_get_16s_blast_scores.py
    deps:
    - path: ./data/taxa/16s_rRNA.csv
      md5: 1b0a6d0685ebb0e678b72cb3b57ae8a4
      size: 21316764
    - path: ./data/taxa/labels.csv
      md5: 22b516c22355a1697527f0099c5b8075
      size: 161752
    - path: ./learn2therm/blast.py
      md5: 1dada75a9efafa27e269ed7285a9c4c0
      size: 31876
    - path: ./learn2therm/io.py
      md5: 0486f89d5dc673fab5af776b57cfd8d2
      size: 3945
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: ./pipeline/s1.2_get_16s_blast_scores.py
      md5: 0bc3de11ded3b112fabb19671dfb1d3f
      size: 6181
    params:
      params.yaml:
        get_16s_blast_scores.blast_metrics:
        - local_gap_compressed_percent_id
        - scaled_local_query_percent_id
        - scaled_local_symmetric_percent_id
        - local_E_value
        - query_align_start
        - query_align_end
        - subject_align_end
        - subject_align_start
        - query_align_len
        - query_align_cov
        - subject_align_len
        - subject_align_cov
        - bit_score
        get_16s_blast_scores.gapextend_penalty: 1
        get_16s_blast_scores.gapopen_penalty: 2
        get_16s_blast_scores.n_sample:
        get_16s_blast_scores.num_threads: 40
        get_16s_blast_scores.penalty: -2
        get_16s_blast_scores.reward: 1
        get_16s_blast_scores.ungapped: false
        get_16s_blast_scores.word_size: 28
    outs:
    - path: ./data/metrics/s1.2_metrics.yaml
      md5: d8037d675c3ac5efbe7fd85ca5316cfd
      size: 51
    - path: ./data/taxa_pairs/16s_align_emissions.csv
      md5: 05d51fc6f8ce7aa2aafb3c734b45126e
      size: 681
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: aa98b55fec7d0b5a937376b14e094864
      size: 105641139
  label_all_pairs:
    cmd: python pipeline/s1.3_label_all_pairs.py
    deps:
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: aa98b55fec7d0b5a937376b14e094864
      size: 105641139
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: ./pipeline/s1.3_label_all_pairs.py
      md5: f0d91704f22ee5db710eee93b4a16607
      size: 3385
    params:
      params.yaml:
        label_all_pairs.blast_metric_thresholds:
          scaled_local_symmetric_percent_id:
            thresh: 0.88
            greater: true
          query_align_cov:
            thresh: 0.75
            greater: true
          subject_align_cov:
            thresh: 0.75
            greater: true
    outs:
    - path: ./data/metrics/s1.3_metrics.yaml
      md5: 17ebe184c757a0eaebe16f820785d8e5
      size: 67
    - path: ./data/taxa_pairs/pair_labels.csv
      md5: 93559135b6d41a9a510a775e0236ecfc
      size: 9633344
  get_protein_blast_scores:
    cmd: python pipeline/s1.4_get_protein_blast_scores.py
    deps:
    - path: ./data/taxa/proteins
      md5: d1c8cfa94113ff9ac352fd400f543432.dir
      size: 24260213045
      nfiles: 16665
    - path: ./data/taxa_pairs/pair_labels.csv
      md5: 93559135b6d41a9a510a775e0236ecfc
      size: 9633344
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: aa98b55fec7d0b5a937376b14e094864
      size: 105641139
    - path: ./learn2therm/blast.py
      md5: 1dada75a9efafa27e269ed7285a9c4c0
      size: 31876
    - path: ./learn2therm/utils.py
      md5: 4845b20446345d469e7eae2a6968e962
      size: 1766
    - path: ./pipeline/s1.4_get_protein_blast_scores.py
      md5: eb41c80cadbf87fcfb66614e41797722
      size: 7262
    params:
      params.yaml:
        get_protein_blast_scores.blast_metrics:
        - local_gap_compressed_percent_id
        - scaled_local_query_percent_id
        - scaled_local_symmetric_percent_id
        - local_E_value
        - query_align_start
        - query_align_end
        - subject_align_end
        - subject_align_start
        - query_align_len
        - query_align_cov
        - subject_align_len
        - subject_align_cov
        - bit_score
        get_protein_blast_scores.checkpoint:
        get_protein_blast_scores.dask_cluster_class: SLURMCluster
        get_protein_blast_scores.max_protein_length: 400
        get_protein_blast_scores.method: diamond
        get_protein_blast_scores.method_blast_params:
          num_threads: 6
          word_size: 3
          gapopen: 11
          gapextend: 1
          matrix: BLOSUM62
          threshold: 11
          ungapped: false
        get_protein_blast_scores.method_diamond_params:
          num_threads: 6
          sensitivity: ultra-sensitive
          iterate: false
          global_ranking:
          gapopen: 11
          gapextend: 1
          matrix: BLOSUM62
        get_protein_blast_scores.n_jobs: 48
        get_protein_blast_scores.primary_sweep: true
        get_protein_blast_scores.restart: true
    outs:
    - path: ./data/metrics/s1.4_metrics.yaml
      md5: ef4bb014b8361bc35a5800cb4dae57ee
      size: 106
    - path: ./data/taxa_pairs/protein_alignment/
      md5: 4ed01b2ae1248d722a86353e0534d16f.dir
      size: 27915017520
      nfiles: 13796
  make_database:
    cmd: python pipeline/s1.5_make_database.py
    deps:
    - path: ./data/taxa/16s_rRNA.csv
      md5: 1b0a6d0685ebb0e678b72cb3b57ae8a4
      size: 21316764
    - path: ./data/taxa/labels.csv
      md5: 22b516c22355a1697527f0099c5b8075
      size: 161752
    - path: ./data/taxa/proteins
      md5: d1c8cfa94113ff9ac352fd400f543432.dir
      size: 24260213045
      nfiles: 16665
    - path: ./data/taxa/taxa_info_and_ogt.csv
      md5: a5bb1873b2aeac4026516a91dd94c3e1
      size: 3826414
    - path: ./data/taxa_pairs/pair_labels.csv
      md5: 93559135b6d41a9a510a775e0236ecfc
      size: 9633344
    - path: ./data/taxa_pairs/pairwise_16s_blast.csv
      md5: aa98b55fec7d0b5a937376b14e094864
      size: 105641139
    - path: ./data/taxa_pairs/protein_alignment/
      md5: 4ed01b2ae1248d722a86353e0534d16f.dir
      size: 27915017520
      nfiles: 13796
    - path: ./learn2therm/database.py
      md5: 8559ad4a1a140274284bcc0674facf40
      size: 13962
    - path: ./pipeline/s1.5_make_database.py
      md5: 9c1b0c6a2ec7453968d84d8a22b7078d
      size: 671
    outs:
    - path: ./data/database
      md5: a893878e4fb7d693f3cdb8f889d0ecbb
      size: 34233659392
  get_raw_data_taxa:
    cmd: python pipeline/s0.0_get_raw_data_taxa.py
    deps:
    - path: pipeline/s0.0_get_raw_data_taxa.py
      md5: 70be4fd1a678b2be181125c79af47bdf
      size: 5882
    params:
      params.yaml:
        get_raw_data_taxa.max_16s_len: 1600
        get_raw_data_taxa.min_16s_len: 1300
    outs:
    - path: ./data/metrics/s0.0_metrics.yaml
      md5: 5dd2e4cdd6433bb2bb4c0ae2b7e2b783
      size: 42
    - path: ./data/taxa.parquet
      md5: e62b6a3fbb8232e4dfeca04c863ba761
      size: 6487331
  get_raw_data_proteins:
    cmd: python pipeline/s0.1_get_raw_data_proteins.py
    deps:
    - path: ./pipeline/s0.1_get_raw_data_proteins.py
      md5: 35f8f12d0b65e2fc6d95011631fe94d2
      size: 2980
    params:
      params.yaml:
        get_raw_data_proteins.dev_only_one_uniprot_file: false
    outs:
    - path: ./data/metrics/s0.1_metrics.yaml
      md5: ce3427ac0343b5f4204dcac97b52a21b
      size: 32
    - path: ./data/uniprot/uniprot_pulled_timestamp
      md5: 94d41857f48c2078539a5792fb0c0e72
      size: 10
  parse_proteins:
    cmd: python pipeline/s0.3_parse_proteins.py
    deps:
    - path: ./data/taxa.parquet
      md5: e62b6a3fbb8232e4dfeca04c863ba761
      size: 6487331
    - path: ./data/uniprot/proteome_metadata.csv
      md5: 443402462165307962a45b7d7dbef5d8
      size: 6275005
    - path: ./data/uniprot/uniprot_pulled_timestamp
      md5: 94d41857f48c2078539a5792fb0c0e72
      size: 10
    - path: ./learn2therm/io.py
      md5: 4f49985e8dcfb88d2c4504744e05d96a
      size: 4031
    - path: ./pipeline/s0.3_parse_proteins.py
      md5: 207e5f22371e1ca6b26471fed7eba44d
      size: 7248
    params:
      params.yaml:
        parse_proteins.dev_only_one_uniprot_file: true
        parse_proteins.max_prot_per_file: 100000
    outs:
    - path: ./data/metrics/s0.3_metrics.yaml
      md5: 19a01cea42c25b43d4d9eea29cf3f36d
      size: 122
    - path: ./data/metrics/s0.3_protein_per_data_distr.csv
      md5: 4dcfd709aa4c3a22af25bf2d07197e2f
      size: 511
    - path: ./data/proteins/
      md5: e8b0b7031673123424f9f71bc09fc149.dir
      size: 87504
      nfiles: 1
  get_proteome_mdata:
    cmd: python pipeline/s0.2_get_proteome_mdata.py
    outs:
    - path: ./data/uniprot/proteome_metadata.csv
      md5: 443402462165307962a45b7d7dbef5d8
      size: 6275005
